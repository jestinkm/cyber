<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Face Recognition Folder Access</title>
    <style>
        /* ---------- BODY & BACKGROUND ---------- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            height: 100vh;
            background: linear-gradient(135deg, #1abc9c, #16a085);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
        }
        h1 {
            margin-top: 30px;
            font-size: 36px;
            color: #fff;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.4);
        }

        /* ---------- VIDEO ---------- */
        video {
            border: 5px solid #fff;
            border-radius: 16px;
            margin-top: 20px;
            max-width: 90%;
            box-shadow: 0 0 25px rgba(0,0,0,0.5);
            transition: all 0.5s ease;
        }

        /* ---------- STATUS ---------- */
        #status {
            margin-top: 20px;
            font-size: 32px;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 16px;
            min-width: 250px;
            transition: all 0.5s ease;
            color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* ---------- ACCURACY ---------- */
        #accuracy {
            margin-top: 10px;
            font-size: 20px;
            color: #fff;
            font-weight: 500;
        }

        /* ---------- ANIMATIONS ---------- */
        @keyframes pulseGlowGreen {
            0% { box-shadow: 0 0 15px #00ff00; transform: scale(1); }
            50% { box-shadow: 0 0 35px #00ff00; transform: scale(1.05); }
            100% { box-shadow: 0 0 15px #00ff00; transform: scale(1); }
        }
        @keyframes pulseGlowRed {
            0% { box-shadow: 0 0 15px #ff4b5c; transform: scale(1); }
            50% { box-shadow: 0 0 35px #ff4b5c; transform: scale(1.05); }
            100% { box-shadow: 0 0 15px #ff4b5c; transform: scale(1); }
        }
        @keyframes waitingPulse {
            0% { box-shadow: 0 0 15px #f1c40f; transform: scale(1); }
            50% { box-shadow: 0 0 30px #f1c40f; transform: scale(1.03); }
            100% { box-shadow: 0 0 15px #f1c40f; transform: scale(1); }
        }

        /* ---------- STATUS CLASSES ---------- */
        .opened {
            animation: pulseGlowGreen 1s infinite;
            color: #00ff00;
        }
        .closed {
            animation: pulseGlowRed 1s infinite;
            color: #ff4b5c;
        }
        .waiting {
            animation: waitingPulse 1s infinite;
            color: #f1c40f;
        }

        /* ---------- VIDEO BORDER EFFECT ---------- */
        .video-opened {
            border-color: #00ff00;
            box-shadow: 0 0 35px #00ff00;
        }
        .video-closed {
            border-color: #ff4b5c;
            box-shadow: 0 0 25px #ff4b5c;
        }
        .video-waiting {
            border-color: #f1c40f;
            box-shadow: 0 0 25px #f1c40f;
        }
    </style>
</head>
<body>
    <h1>Face Recognition Folder Access</h1>
    <video id="video" width="640" height="480" autoplay muted playsinline></video>
    <div id="status" class="waiting">Initializing...</div>
    <div id="accuracy"></div>

    <script>
        const video = document.getElementById('video');
        const statusDiv = document.getElementById('status');
        const accuracyDiv = document.getElementById('accuracy');

        // ---------- ACCESS WEBCAM ----------
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false })
            .then(stream => { video.srcObject = stream; })
            .catch(err => {
                statusDiv.innerText = "❌ Camera access denied: " + err;
                statusDiv.classList.remove('opened', 'waiting');
                statusDiv.classList.add('closed');
                video.classList.add('video-closed');
            });

        // ---------- CAPTURE FRAME ----------
        function captureFrame() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            return canvas.toDataURL('image/jpeg');
        }

        // ---------- SEND FRAME TO SERVER ----------
        async function checkFace() {
            const imageData = captureFrame();
            try {
                const response = await fetch('/check_face', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData })
                });
                const data = await response.json();

                // Reset classes
                statusDiv.classList.remove('opened', 'closed', 'waiting');
                video.classList.remove('video-opened', 'video-closed', 'video-waiting');

                // ---------- UPDATE STATUS ----------
                if (data.matched) {
                    statusDiv.innerText = "✅ Folder Opened";
                    statusDiv.classList.add('opened');
                    video.classList.add('video-opened');
                } else if(data.status === "closed") {
                    statusDiv.innerText = "❌ Folder Closed";
                    statusDiv.classList.add('closed');
                    video.classList.add('video-closed');
                } else {
                    statusDiv.innerText = "⌛ Waiting for Match...";
                    statusDiv.classList.add('waiting');
                    video.classList.add('video-waiting');
                }

                // ---------- UPDATE ACCURACY ----------
                if(data.accuracy !== undefined) {
                    accuracyDiv.innerText = "Face Accuracy: " + data.accuracy + "%";
                }

            } catch (err) {
                console.error(err);
                statusDiv.innerText = "❌ Server connection error";
                statusDiv.classList.add('closed');
                video.classList.add('video-closed');
            }
        }

        // ---------- RUN EVERY SECOND ----------
        setInterval(checkFace, 1000);
    </script>
</body>
</html>
